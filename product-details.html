<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fawaz Fragrance | Product Details</title>

  <link rel="icon" href="Favicon.png" type="image/png">

  <link rel="stylesheet" href="style.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
  
  <style>
    :root{
      --bg:#fff; --text:#111; --muted:#6b6b6b; --gold:#b99056; --accent:#0b0b0b;
      --beige:#f5efe8; --card-shadow:0 8px 24px rgba(12,12,12,0.12);
      --max-width:1200px;
    }
    
    /* Universal Reset */
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body { 
      font-family: 'Lato', Arial, sans-serif; 
      background: var(--beige); 
      color: var(--text);
      overflow-x: hidden;
    }

    /* ======================
       FAWAZ HEADER (DIZSOL STYLE)
       ====================== */
    .ff-header {
      width: 100%;
      background: #FFFCE9;
      position: sticky;
      top: 0;
      z-index: 300;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .ff-header-inner {
      max-width: 1200px;
      height: 60px;
      margin: auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      position: relative;
    }

    /* Left: Hamburger */
    .ff-ham {
      width: 24px;
      display: flex;
      flex-direction: column;
      gap: 5px;
      cursor: pointer;
      z-index: 302;
    }
    .ff-ham span {
      width: 100%;
      height: 2px;
      background: #111;
      border-radius: 2px;
    }

    /* Center: Logo */
    .ff-logo {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      z-index: 301;
    }
    .ff-logo img {
      height: 36px;
      width: auto;
      display: block;
    }

    /* Right: Search Icon */
    .ff-search-trigger {
      cursor: pointer;
      font-size: 20px;
      color: #111;
      z-index: 302;
      width: 24px;
      text-align: right;
    }

    /* Hidden Search Overlay */
    .ff-search-bar {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #FFFCE9;
      display: flex;
      align-items: center;
      padding: 0 16px;
      z-index: 305;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    .ff-search-bar.active {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    .ff-search-bar input {
      flex: 1;
      border: none;
      background: transparent;
      font-family: 'Lato', sans-serif;
      font-size: 16px;
      color: #111;
      outline: none;
      padding: 0 10px;
    }
    .ff-search-close {
      font-size: 20px;
      color: #666;
      cursor: pointer;
      padding: 5px;
    }

    /* Mobile Menu Drawer */
    .ff-mobile-menu {
      position: fixed;
      top: 60px;
      right: -280px;
      width: 260px;
      height: 100vh;
      background: #FFFCE9;
      border-left: 2px solid #fffce9;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 18px;
      font-weight: 600;
      transition: right .3s ease-in-out;
      z-index: 500;
    }
    .ff-mobile-menu a { color: #664136; font-size: 16px; text-decoration: none; }
    .ff-mobile-menu.open { right: 0; box-shadow: -12px 0 32px rgba(0,0,0,0.2); }

    /* ================= PRODUCT DETAILS ================= */
    .container { max-width: 1100px; margin: 30px auto; padding: 20px; display: flex; flex-wrap: wrap; gap: 40px; }

    .product-image { flex: 1 1 400px; }
    .product-image img { width: 100%; border-radius: 10px; box-shadow: var(--card-shadow); }

    .product-info { flex: 1 1 500px; }
    .product-info h1 { margin: 0 0 15px; font-size: 2rem; color: var(--accent); font-family: 'Playfair Display', serif; }
    
    .product-price { font-size: 1.4rem; font-weight: bold; margin-bottom: 20px; color: var(--accent); display: flex; align-items: center;}
    .old-price { text-decoration: line-through; color: #b87a7a; margin-right: 10px; font-size: 1.2rem; opacity: 0.8; }
    
    .product-desc { font-size: 1rem; color: #444; margin-bottom: 20px; line-height: 1.6; }

    .product-details { margin-bottom: 20px; }
    .product-category { display: inline-block; background: var(--gold); color: #fff; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; margin-bottom: 10px; font-weight: 600; }
    
    .volume-selector { margin-bottom: 15px; }
    .volume-selector label { display: block; font-weight: 600; margin-bottom: 8px; color: var(--accent); }
    .volume-options { display: flex; gap: 8px; flex-wrap: wrap; }
    .volume-option { padding: 8px 16px; border: 2px solid #ddd; border-radius: 6px; cursor: pointer; transition: 0.3s; background: #fff; }
    .volume-option:hover { border-color: var(--gold); }
    .volume-option.selected { border-color: var(--gold); background: var(--beige); color: var(--accent); }
    
    .detailed-desc { background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid var(--gold); box-shadow: var(--card-shadow); }
    .detailed-desc h3 { margin: 0 0 8px; font-size: 1.1rem; color: var(--accent); font-family: 'Playfair Display', serif;}
    .detailed-desc p { margin: 0; line-height: 1.5; color: #555; }

    .actions { display: flex; align-items: center; gap: 15px; margin-bottom: 40px; }
    .quantity-box { display: flex; border: 1px solid #ccc; border-radius: 6px; overflow: hidden; background: #fff; }
    .quantity-box button { background: #f5f5f5; border: none; padding: 8px 14px; cursor: pointer; font-size: 1.2rem; }
    .quantity-box input { width: 50px; text-align: center; border: none; font-size: 1rem; }
    .add-to-cart-btn { background: var(--gold); color: #fff; padding: 10px 22px; border: none; border-radius: 25px; cursor: pointer; transition: 0.3s; font-weight: 700; }
    .add-to-cart-btn:hover { background: #a67c44; }

    /* ================= CART STYLES ================= */
    .cart-btn{position:fixed;right:16px;bottom:16px;background:var(--gold);border-radius:50%;width:60px;height:60px;display:flex;align-items:center;justify-content:center;box-shadow:var(--card-shadow);cursor:pointer;z-index:200}
    .cart-count{position:absolute;top:6px;right:6px;background:#111;color:#fff;border-radius:50%;width:22px;height:22px;display:flex;align-items:center;justify-content:center;font-size:12px}
    
    .cart-panel{position:fixed;right:0;top:0;height:100vh;width:400px;max-width:100vw;background:#fff;box-shadow:-20px 0 40px rgba(0,0,0,0.08);transform:translateX(100%);transition:transform .3s;padding:20px;z-index:2000;display:flex;flex-direction:column;overflow-y:auto; box-sizing: border-box;}
    .cart-panel.open{transform:translateX(0); z-index: 2000;}
    
    .cart-item{display:flex;align-items:center;gap:8px;margin-bottom:10px;padding:6px;background:#f5f5f5;border-radius:6px}
    .cart-item img{width:50px;height:50px;object-fit:cover;border-radius:6px;margin-right:8px}
    .qty-controls{display:flex;gap:4px;align-items:center}
    .qty-controls button{padding:2px 6px;cursor:pointer;border-radius:4px;border:none;background:#ccc}
    
    .cart-total { margin-top: 12px; font-weight: 700; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
    .cart-discount-note { margin: 12px 0 8px; color: #777; font-size: 0.92rem; font-weight: 600; }
    .cart-shipping-note { margin-top: 6px; color: #777; font-size: 0.85rem; }
    .discounted-total { margin-top: 8px; font-weight: 800; color: var(--gold); font-size: 1.05rem; }
    .free-shipping-progress { margin-top: 14px; color: #666; font-size: 0.95rem; text-align: center; }

    .cart-form{display:none;flex-direction:column;gap:6px;margin-top:12px}
    .cart-form input,.cart-form select{padding:8px;border-radius:6px;border:1px solid rgba(0,0,0,0.2)}
    .pay-btn{margin-top:10px;padding:10px;border:none;border-radius:6px;background:var(--gold);color:#fff;cursor:pointer;font-weight:700}
    .pay-btn:hover{background:#a67c44}
    .close-cart{position:absolute;top:10px;right:10px;cursor:pointer;font-size:24px}

    /* Sticky Checkout Button */
    .sticky-checkout { position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%); background: var(--gold); color: #fff; font-weight: 700; padding: 12px 20px; border-radius: 999px; box-shadow: var(--card-shadow); cursor: pointer; z-index: 300; display: none; }

    /* Footer Styles */
    .main-footer { background: linear-gradient(135deg, #1a1a1a 0%, #0d0d0d 100%); color: #fff; margin-top: 60px; font-family: Lato, Arial, sans-serif; }
    .footer-content { max-width: var(--max-width); margin: 0 auto; padding: 50px 16px 30px; }
    .footer-links { display: grid; grid-template-columns: repeat(4, 1fr); gap: 60px; align-items: start; }
    .footer-column h4 { font-family: 'Playfair Display', serif; font-size: 20px; margin-bottom: 20px; color: var(--gold); }
    .footer-column ul { list-style: none; }
    .footer-column ul li { margin-bottom: 12px; }
    .footer-column ul li a { color: rgba(255, 255, 255, 0.8); text-decoration: none; transition: color 0.3s; font-size: 15px; }
    .footer-column ul li a:hover { color: var(--gold); }
    .social-link { display: flex; align-items: center; gap: 10px; color: rgba(255, 255, 255, 0.8); text-decoration: none; margin-bottom: 10px; transition: color 0.3s; font-size: 15px; }
    .social-link:hover { color: var(--gold); }
    .social-link i { color: var(--gold); width: 20px; text-align: center; font-size: 18px; }
    .contact-info p { color: rgba(255, 255, 255, 0.8); margin-bottom: 12px; font-size: 15px; display: flex; align-items: center; gap: 10px; }
    .contact-info i { color: var(--gold); font-size: 18px; width: 24px; text-align: center; }
    
    .newsletter-form { display: flex; width: 100%; max-width: 420px; gap: 0; }
    .newsletter-input { flex: 1; padding: 14px 18px; border: none; border-radius: 8px 0 0 8px; font-size: 16px; background: rgba(255, 255, 255, 0.9); color: var(--accent); }
    .newsletter-btn { padding: 14px 24px; background: var(--gold); color: #fff; border: none; border-radius: 0 8px 8px 0; font-weight: 700; cursor: pointer; transition: background 0.3s; }

    .footer-bottom { border-top: 1px solid rgba(255, 255, 255, 0.1); background: transparent; padding: 20px 0;}
    .footer-bottom-content { max-width: var(--max-width); margin: 0 auto; padding: 0 16px; display: flex; flex-direction: column; align-items: center; gap: 15px; text-align: center; }
    .footer-legal, .legal-links, .footer-badges { display: flex; align-items: center; justify-content: center; gap: 20px; flex-wrap: wrap; }
    .legal-links a { color: rgba(255, 255, 255, 0.6); text-decoration: none; font-size: 14px; }
    .badge { background: rgba(185, 144, 86, 0.2); color: var(--gold); padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; border: 1px solid rgba(185, 144, 86, 0.3); }

    @media (max-width: 800px) {
      .footer-links { grid-template-columns: repeat(2, 1fr); text-align: center; }
      .footer-column { margin-bottom: 30px; }
      .newsletter-form { margin: 0 auto; }
      .social-link, .contact-info p { justify-content: center; }
    }
    @media (max-width: 600px) {
      .footer-links { grid-template-columns: 1fr; }
      .cart-panel { width: 100%; }
      .newsletter-form { flex-direction: column; }
      .newsletter-input { border-radius: 8px; margin-bottom: 10px; }
      .newsletter-btn { border-radius: 8px; }
      .volume-options { flex-direction: column; }
    }
/* New Full-Width Bottom Row */
.bulk-wholesale-row {
  width: 100%;
  text-align: center;         /* Centralized for Phone & Desktop */
  margin-top: 40px;           /* Space above it */
  padding-top: 20px;
  border-top: 1px solid rgba(255,255,255,0.1); /* Nice divider line */
  color: rgba(255,255,255,0.6);
  font-size: 15px;
  clear: both;                /* Ensures it stays below everything */
}
.bulk-wholesale-row a {
  color: var(--gold);
  font-weight: 700;
  text-decoration: none;
  margin-left: 4px;
}
.bulk-wholesale-row a:hover {
  text-decoration: underline;
}
  </style>
</head>
<body>

  <header class="ff-header">
    <div class="ff-header-inner">

      <div class="ff-ham" id="hamburgerBtn">
        <span></span>
        <span></span>
        <span></span>
      </div>

      <div class="ff-logo">
        <a href="index.html"><img src="Logo.png" alt="Fawaz Fragrance"></a>
      </div>

      <div class="ff-search-trigger" id="searchTriggerBtn">
        <i class="fas fa-search"></i>
      </div>

      <div class="ff-search-bar" id="searchOverlay">
        <i class="fas fa-search" style="color:#aaa; font-size:16px;"></i>
        <input id="searchInput" type="text" placeholder="Search for perfumes...">
        <i class="fas fa-times ff-search-close" id="closeSearchBtn"></i>
      </div>

    </div>
  </header>

  <div class="ff-mobile-menu" id="ffMobileMenu">
    <a href="index.html">Home</a>
    <a href="products.html">All Products</a>
    <a href="journal.html">Journal</a>
    <a href="about.html">About</a>
  </div>

  <div class="container">
    <div class="product-image">
      <img id="productImg" src="" alt="Product Image"/>
    </div>
    <div class="product-info">
      <div class="product-category" id="productCategory">Luxury Collection</div>
      <h1 id="productName"></h1>
      <div class="product-price">
        <span id="oldPrice" class="old-price"></span>
        <span id="productPrice"></span>
      </div>

      <p class="product-desc" id="productDesc"></p>

      <div class="product-details">
        <div class="volume-selector">
          <label for="volumeOptions">Select Volume:</label>
          <div class="volume-options" id="volumeOptions">
            <div class="volume-option selected" data-volume="6ml" data-price="0">6ml - â‚¹<span class="vol-price">0</span></div>
            </div>
        </div>

        <div class="detailed-desc">
          <h3>Product Details</h3>
          <p id="detailedDescription">
            This exquisite fragrance opens with vibrant top notes that captivate the senses, 
            transitioning into a sophisticated heart that embodies elegance and charm. 
            The base notes provide lasting depth and warmth, creating a memorable signature scent 
            that's perfect for both day and evening wear. Crafted with premium ingredients 
            for exceptional longevity and projection.
          </p>
        </div>
      </div>

      <div class="actions">
        <div class="quantity-box">
          <button onclick="changeQty(-1)">-</button>
          <input type="text" id="quantity" value="1" readonly />
          <button onclick="changeQty(1)">+</button>
        </div>
        <button class="add-to-cart-btn" onclick="addToCart()">Add to Cart</button>
      </div>
    </div>
  </div>

  <div class="cart-btn" id="cartBtn">ðŸ›’<div class="cart-count" id="cartCount">0</div></div>

  <div class="cart-panel" id="cartPanel" aria-hidden="true">
    <span class="close-cart" id="closeCart">&times;</span>
    <h3>Your Cart</h3>
    <div id="cartItems"></div>
    <div class="cart-total" id="cartTotal">Total: â‚¹0</div>
    <button class="pay-btn" id="checkoutBtn">Checkout</button>

    <div class="cart-form" id="cartForm">
      <h3>Checkout Details</h3>
      <input type="text" id="customerName" placeholder="Full Name" required />
      <input type="tel" id="customerPhone" placeholder="Phone Number" required />
      <input type="email" id="customerEmail" placeholder="Email" required />
      <input type="text" id="customerStreet" placeholder="Street Address" required />
      <input type="text" id="customerCity" placeholder="City" required />
      <input type="text" id="customerState" placeholder="State" required />
      <input type="text" id="customerLandmark" placeholder="Landmark" required />
      <input type="text" id="customerZip" placeholder="Zipcode" required />
      <input type="text" id="customerFlat" placeholder="Flat / House / Room Number" required />
      <input type="text" id="customerCountry" placeholder="Country" required />
      <button class="pay-btn" id="confirmPayBtn">Confirm & Pay via WhatsApp</button>
      <button class="pay-btn" id="backBtn" style="background:#ccc;color:#111;margin-top:6px;">Back</button>
    </div>
  </div>

  <div class="sticky-checkout" id="stickyCheckout">Checkout (â‚¹0)</div>

  <footer class="main-footer">
    <div class="footer-content">

    <div class="footer-links">

      <div class="footer-column">
        <h4>Shop</h4>
        <ul>
          <li><a href="products.html">All Perfumes</a></li>
          <li><a href="products.html?category=Classic">Classic Collection</a></li>
          <li><a href="products.html?category=Luxury">Luxury Collection</a></li>
          <li><a href="products.html?category=Modern">Modern Collection</a></li>
          <li><a href="#bestsellers">Best Sellers</a></li>
        </ul>
      </div>

      <div class="footer-column">
        <h4>Connect</h4>
        <a class="social-link" href="https://www.facebook.com/profile.php?id=61578977254156"><i class="fab fa-facebook-f"></i> Facebook</a>
        <a class="social-link" href="https://www.instagram.com/fawazfragrance/"><i class="fab fa-instagram"></i> Instagram</a>
        <a class="social-link" href="https://in.pinterest.com/fawazfragrance/"><i class="fab fa-pinterest-p"></i> Pinterest</a>
      </div>

      <div class="footer-column">
        <h4>Customer Service</h4>
        <p><i class="fas fa-phone"></i> +91 9004263544</p>
        <p><i class="fas fa-envelope"></i> fawazfragnance@gmail.com</p>
        <p><i class="fas fa-clock"></i> Monâ€“Fri: 9AMâ€“6PM IST</p>
      </div>

      <div class="footer-column">
          <h4>Stay In The Loop</h4>
          <p style="color:rgba(255,255,255,0.75);font-size:14px;margin-bottom:12px;">
            Subscribe to get special offers, exclusive launches, and fragrance tips.
          </p>
          <div class="newsletter-form" style="display:flex;gap:0;">
            <input id="footerNewsInput" type="email" placeholder="Enter your email" class="newsletter-input" style="border-radius:6px 0 0 6px;">
            <button id="footerNewsBtn" class="newsletter-btn" style="border-radius:0 6px 6px 0;">Subscribe</button>
          </div>
        </div>

    </div> 
    <div class="bulk-wholesale-row">
      For Bulk and Wholesale enquiry please drop an email <strong>fawazfragnance@gmail.com</strong>.
    </div>

</div>

    <div class="footer-bottom">
      <div class="footer-bottom-content">
        <div class="footer-legal">
          <p>&copy; 2025 Fawaz Fragrence. All rights reserved. Crafted by Eaz Nexora</p>
          <div class="legal-links">
            <a href="privacy.html">policies</a>
            <a href="terms.html">Terms of Service</a>
          </div>
        </div>
        <div class="footer-badges">
          <div class="badge">ðŸ”’ Secure Shopping</div>
          <div class="badge">ðŸšš Free Shipping â‚¹999+</div>
          </div>
      </div>
    </div>
  </footer>

<script>
function generateOrderNumber() {
  const today = new Date();
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth() + 1).padStart(2, '0');
  const dd = String(today.getDate()).padStart(2, '0');
  const datePart = `${yyyy}${mm}${dd}`;
  const key = `fwz_order_${datePart}`;
  let lastNo = parseInt(localStorage.getItem(key) || "0");
  lastNo++;
  localStorage.setItem(key, lastNo);
  return `FWZ-${datePart}-${String(lastNo).padStart(5, '0')}`;
}

// ====== GLOBAL SETTINGS ======
const DISCOUNT_RATE = 0.125;   // 12.5% discount
const SHIPPING_CHARGE = 75;
const FREE_SHIPPING_THRESHOLD = 599;
const CART_KEY = 'alabwa_cart_v1';

// ====== URL Parameters ======
const urlParams = new URLSearchParams(window.location.search);
const name = urlParams.get('name') ? decodeURIComponent(urlParams.get('name')) : '';
const priceParam = urlParams.get('price') ? decodeURIComponent(urlParams.get('price')) : '';
const img = urlParams.get('img') ? decodeURIComponent(urlParams.get('img')) : '';
const desc = urlParams.get('desc') ? decodeURIComponent(urlParams.get('desc')) : '';
const detailsParam = urlParams.get('details') ? decodeURIComponent(urlParams.get('details')) : '';
const notesParam = urlParams.get('notes') ? decodeURIComponent(urlParams.get('notes')) : '';

const cleanPrice = (txt) => parseInt(String(txt || '').replace(/[^\d]/g,''),10) || 0;

let basePrice = 0;
let selectedVolume = '6ml'; 
let cart = [];

function loadCart() {
  try { cart = JSON.parse(localStorage.getItem(CART_KEY) || '[]'); } catch(e) { cart = []; }
  renderCart();
}

function saveCart() {
  localStorage.setItem(CART_KEY, JSON.stringify(cart));
}

// ====== RENDER CART ======
function renderCart() {
  const cartItemsEl = document.getElementById('cartItems');
  const cartTotalEl = document.getElementById('cartTotal');
  const cartCountEl = document.getElementById('cartCount');
  const stickyCheckout = document.getElementById('stickyCheckout');
  const cartBtn = document.getElementById('cartBtn');
  const checkoutBtn = document.getElementById('checkoutBtn'); // Get checkout btn
  const cartForm = document.getElementById('cartForm');       // Get form

  if (!cartItemsEl) return;
  cartItemsEl.innerHTML = '';

  let originalSubtotal = 0;
  cart.forEach(item => { originalSubtotal += item.price * item.qty; });

  let shipping = 0;
  if (cart.length > 0 && originalSubtotal < FREE_SHIPPING_THRESHOLD) {
      shipping = SHIPPING_CHARGE;
  }

  let discountedSubtotal = 0;
  cart.forEach(item => {
    const discountedUnit = Math.round(item.price * (1 - DISCOUNT_RATE));
    discountedSubtotal += discountedUnit * item.qty;
  });

  const originalTotalWithShipping = originalSubtotal + shipping;
  const discountedTotalWithShipping = discountedSubtotal + shipping;

  // Render Items
  if (cart.length === 0) {
      cartItemsEl.innerHTML = '<div style="text-align:center; padding:20px; color:#666;">Your cart is empty</div>';
  } else {
      cart.forEach((item, idx) => {
        const row = document.createElement('div');
        row.className = 'cart-item';

        const imgEl = document.createElement('img');
        imgEl.src = item.image;
        imgEl.alt = item.name;

        const nameSpan = document.createElement('span');
        nameSpan.textContent = item.name;
        nameSpan.style.flex = '1';

        const qtyDiv = document.createElement('div');
        qtyDiv.className = 'qty-controls';
        const dec = document.createElement('button');
        dec.textContent = '-';
        dec.addEventListener('click', () => changeCartQty(idx, -1));
        const qtyNum = document.createElement('span');
        qtyNum.textContent = item.qty;
        qtyNum.style.margin = '0 8px';
        const inc = document.createElement('button');
        inc.textContent = '+';
        inc.addEventListener('click', () => changeCartQty(idx, +1));
        qtyDiv.append(dec, qtyNum, inc);

        const priceSpan = document.createElement('span');
        priceSpan.textContent = `â‚¹${item.price * item.qty}`;

        row.append(imgEl, nameSpan, qtyDiv, priceSpan);
        cartItemsEl.appendChild(row);
      });
  }

  if (cart.length > 0) {
    const dNote = document.createElement('div');
    dNote.className = 'cart-discount-note';
    dNote.textContent = 'Introductory Offer @12.5% on each product has been applied';
    cartItemsEl.appendChild(dNote);
  }

  if (cartTotalEl) {
    cartTotalEl.innerHTML = `<span>Total: â‚¹${cart.length > 0 ? originalTotalWithShipping : 0}</span>`;
    if (shipping > 0) {
      const sNote = document.createElement('span');
      sNote.className = 'cart-shipping-note';
      sNote.textContent = `Includes â‚¹${shipping} Shipping Charges`;
      cartTotalEl.appendChild(sNote);
    }
  }

  let discountedEl = document.getElementById('discountedTotalEl');
  if (!discountedEl) {
    discountedEl = document.createElement('div');
    discountedEl.id = 'discountedTotalEl';
    discountedEl.className = 'discounted-total';
    cartTotalEl.insertAdjacentElement('afterend', discountedEl);
  }
  
  if (cart.length > 0) {
      discountedEl.textContent = `Discounted Total: â‚¹${discountedTotalWithShipping}`;
      discountedEl.style.display = 'block';
  } else {
      discountedEl.style.display = 'none';
  }

  let progressEl = document.getElementById('freeShippingProgress');
  if (!progressEl) {
    progressEl = document.createElement('div');
    progressEl.id = 'freeShippingProgress';
    progressEl.className = 'free-shipping-progress';
    document.getElementById('cartPanel').appendChild(progressEl);
  }

  if (cart.length > 0) {
      const amountNeeded = Math.max(0, FREE_SHIPPING_THRESHOLD - originalSubtotal);
      progressEl.textContent = amountNeeded > 0
        ? `â‚¹${amountNeeded} away from free shipping`
        : `You have free shipping!`;
      progressEl.style.display = 'block';
  } else {
      progressEl.style.display = 'none';
  }

  if (cartCountEl) cartCountEl.textContent = cart.reduce((s,i)=> s + i.qty, 0);

  if (cartBtn) cartBtn.style.display = cart.length === 0 ? 'none' : 'flex';

  if (stickyCheckout) {
    const isCartOpen = document.getElementById('cartPanel').classList.contains('open');
    if (cart.length > 0 && originalTotalWithShipping > 0 && !isCartOpen) {
      stickyCheckout.textContent = `Checkout (â‚¹${originalTotalWithShipping})`;
      stickyCheckout.style.display = 'block';
    } else {
      stickyCheckout.style.display = 'none';
    }
  }

  // [FIX] Hide Checkout Button if Empty
  if (checkoutBtn) {
      if(cart.length === 0) {
          checkoutBtn.style.display = 'none';
          if(cartForm) cartForm.style.display = 'none';
      } else {
          checkoutBtn.style.display = 'block';
      }
  }

  saveCart();
}

function changeCartQty(idx, delta) {
  if (!cart[idx]) return;
  cart[idx].qty += delta;
  if (cart[idx].qty <= 0) cart.splice(idx,1);
  renderCart();
}

// Initial Page Load
if (name && priceParam && img) {
  basePrice = cleanPrice(priceParam);
  document.getElementById('productName').textContent = name;
  document.getElementById('oldPrice').textContent = 'â‚¹' + (basePrice + 40);
  document.getElementById('productPrice').textContent = 'â‚¹' + basePrice;
  document.getElementById('productDesc').textContent = desc || '';
  document.getElementById('productImg').src = img;
  document.getElementById('productImg').alt = name;
  
  const categoryMap = { 'Amber Noir': 'Classic Collection', 'Royal Oud': 'Luxury Collection', 'Velour Rose': 'Floral Collection', 'Ocean Mist': 'Fresh Collection', 'Golden Sandal': 'Woody Collection', 'Fresh Citrus': 'Citrus Collection' };
  document.getElementById('productCategory').textContent = categoryMap[name] || 'Premium Collection';
  
  const detailContainer = document.getElementById('detailedDescription');
  let finalHtml = detailsParam || `This exquisite fragrance opens with vibrant top notes...`;
  if (notesParam) finalHtml += `<br><br><strong>Olfactory Notes:</strong><br>${notesParam}`;
  detailContainer.innerHTML = finalHtml;

  updateVolumePrices();
}

function updateVolumePrices() {
  const volumeOptions = document.querySelectorAll('.volume-option');
  volumeOptions.forEach(option => {
    const extraPrice = parseInt(option.dataset.price);
    option.querySelector('.vol-price').textContent = basePrice + extraPrice;
  });
}

document.addEventListener('click', function(e) {
  const volumeOption = e.target.closest('.volume-option');
  if (volumeOption) {
    document.querySelectorAll('.volume-option').forEach(opt => opt.classList.remove('selected'));
    volumeOption.classList.add('selected');
    selectedVolume = volumeOption.dataset.volume;
    const extraPrice = parseInt(volumeOption.dataset.price);
    document.getElementById('productPrice').textContent = 'â‚¹' + (basePrice + extraPrice);
  }
});

function changeQty(delta) {
  const qtyEl = document.getElementById('quantity');
  let val = parseInt(qtyEl.value,10) || 1;
  val = Math.max(1, val + delta);
  qtyEl.value = val;
}

function openCartPanel() {
  const cartPanel = document.getElementById('cartPanel');
  cartPanel.classList.add('open');
  cartPanel.setAttribute('aria-hidden','false');
  document.getElementById('stickyCheckout').style.display = 'none';
}

function closeCartPanel() {
  const cartPanel = document.getElementById('cartPanel');
  cartPanel.classList.remove('open');
  cartPanel.setAttribute('aria-hidden','true');
  renderCart();
}

// Interaction Event Listeners
document.getElementById('cartBtn').addEventListener('click', openCartPanel);
document.getElementById('closeCart').addEventListener('click', closeCartPanel);
document.getElementById('cartPanel').addEventListener('click', (event) => event.stopPropagation());
document.addEventListener('click', function(e) {
  const cartPanel = document.getElementById('cartPanel');
  const cartBtn = document.getElementById('cartBtn');
  if (!cartPanel.classList.contains('open')) return;
  if (cartBtn.contains(e.target)) return;
  if (document.getElementById('stickyCheckout').contains(e.target)) return;
  if (cartPanel.contains(e.target)) return;
  closeCartPanel();
});

function addToCart() {
  const qty = parseInt(document.getElementById('quantity').value,10) || 1;
  const selectedOption = document.querySelector('.volume-option.selected');
  const extraPrice = parseInt(selectedOption.dataset.price);
  const finalPrice = basePrice + extraPrice;
  const item = { name: name, price: finalPrice, image: img, qty: qty };
  
  const existing = cart.find(p => p.name === item.name);
  if (existing) existing.qty += qty;
  else cart.push(item);
  
  renderCart();
  openCartPanel();
}

// Checkout Logic [FIXED]
document.getElementById('checkoutBtn').addEventListener('click', () => { 
    if (cart.length === 0) {
        alert("Your cart is empty!");
        return;
    }
    document.getElementById('cartForm').style.display = 'flex'; 
});
document.getElementById('backBtn').addEventListener('click', () => { document.getElementById('cartForm').style.display = 'none'; });

document.getElementById('confirmPayBtn').addEventListener('click', () => {
  const name = document.getElementById('customerName').value.trim();
  const phone = document.getElementById('customerPhone').value.trim();
  const email = document.getElementById('customerEmail').value.trim();
  const street = document.getElementById('customerStreet').value.trim();
  const city = document.getElementById('customerCity').value.trim();
  const state = document.getElementById('customerState').value.trim();
  const landmark = document.getElementById('customerLandmark').value.trim();
  const zipcode = document.getElementById('customerZip').value.trim();
  const flat = document.getElementById('customerFlat').value.trim();
  const country = document.getElementById('customerCountry').value.trim();

  if (!name || !phone || !email || !street || !city || !state || !landmark || !zipcode || !flat || !country) {
    alert('Please fill in all details!');
    return;
  }
  if (!cart.length) { alert('Your cart is empty!'); return; }

  let originalSubtotal = 0;
  let discountedSubtotal = 0;
  cart.forEach(item => {
    originalSubtotal += item.price * item.qty;
    discountedSubtotal += Math.round(item.price * (1 - DISCOUNT_RATE)) * item.qty;
  });

  const shipping = originalSubtotal >= FREE_SHIPPING_THRESHOLD ? 0 : SHIPPING_CHARGE;
  const finalTotal = discountedSubtotal + shipping;
  const orderNumber = generateOrderNumber();

  let msg = `*ðŸ§¾ ORDER CONFIRMATION*\n\n*Order Number:* ${orderNumber}\n\n*ðŸ‘¤ Customer:* ${name}\n*ðŸ“ž Phone:* ${phone}\n*âœ‰ï¸ Email:* ${email}\n\n*ðŸ  Address:*\n${flat}\n${street}, ${landmark}\n${city}, ${state} - ${zipcode}\n${country}\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n*ðŸ§´ Order Details:*\n`;
  cart.forEach(item => {
    const disc = Math.round(item.price * (1 - DISCOUNT_RATE));
    msg += `â€¢ ${item.qty} Ã— ${item.name} â€” â‚¹${disc * item.qty}\n`;
  });
  msg += `\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n*ðŸ’µ Total Payable:* â‚¹${finalTotal}\n\nðŸ™ Thank you for shopping with *Fawaz Fragrance*`;

  window.open(`https://wa.me/919004263544?text=${encodeURIComponent(msg)}`, "_blank");
});

document.getElementById('stickyCheckout').addEventListener('click', () => { openCartPanel(); });

// ====== FOOTER NEWSLETTER WHATSAPP LOGIC ======
const footerNewsBtn = document.getElementById('footerNewsBtn');
if (footerNewsBtn) {
  footerNewsBtn.addEventListener('click', function() {
    const emailInput = document.getElementById('footerNewsInput');
    const email = emailInput.value.trim();

    if (!email) {
      alert('Please enter your email address.');
      return;
    }

    const msg = `*ðŸ”” NEWSLETTER SIGNUP*\n\nHello, I would like to stay in the loop!\n\n*My Email:* ${email}`;
    window.open(`https://wa.me/919004263544?text=${encodeURIComponent(msg)}`, '_blank');
    emailInput.value = '';
  });
}

// ====== HEADER LOGIC (Menu Fixed) ======
const ffHam = document.getElementById("hamburgerBtn");
const ffMenu = document.getElementById("ffMobileMenu");

if (ffHam && ffMenu) {
  ffHam.addEventListener("click", (e) => {
    e.stopPropagation(); // Prevent immediate closing
    ffMenu.classList.toggle("open");
  });

  // Close menu when clicking outside
  document.addEventListener('click', function(e) {
    if (ffMenu.classList.contains('open')) {
      const clickedInsideMenu = ffMenu.contains(e.target);
      const clickedOnHam = ffHam.contains(e.target);
      
      if (!clickedInsideMenu && !clickedOnHam) {
        ffMenu.classList.remove('open');
      }
    }
  });
}

const searchTrigger = document.getElementById('searchTriggerBtn');
const searchOverlay = document.getElementById('searchOverlay');
const closeSearch = document.getElementById('closeSearchBtn');
const sInput = document.getElementById('searchInput');

if (searchTrigger) {
  searchTrigger.addEventListener('click', () => {
    searchOverlay.classList.add('active');
    setTimeout(() => sInput.focus(), 100); 
  });
}
if (closeSearch) {
  closeSearch.addEventListener('click', () => {
    searchOverlay.classList.remove('active');
  });
}
if (sInput) {
  sInput.addEventListener('keydown', (e)=>{
    if (e.key === 'Enter') {
        e.preventDefault();
        window.location.href = "products.html?search=" + encodeURIComponent(sInput.value);
    }
  });
}

loadCart();
</script>
</body>
</html>
